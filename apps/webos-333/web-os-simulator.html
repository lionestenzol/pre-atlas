<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web OS</title>
    <style>
        :root {
            /* Windows 95 Theme (Default) */
            --desktop-bg: #008080;
            --taskbar-bg: #c0c0c0;
            --taskbar-border: #f0f0f0;
            --window-bg: #c0c0c0;
            --window-border: #f0f0f0;
            --titlebar-bg: #000080;
            --titlebar-text: #ffffff;
            --titlebar-inactive: #808080;
            --button-bg: #c0c0c0;
            --button-border: #adadad;
            --button-highlight: #ffffff;
            --content-bg: #ffffff;
            --text-color: #000000;
            --menu-hover: #000080;
            --menu-hover-text: #ffffff;
            --start-button-bg: #008080;
            --accent-color: #000080;
        }

        .theme-xp {
            --desktop-bg: #3a6ea5;
            --taskbar-bg: linear-gradient(to bottom, #3168d5, #1941a5);
            --taskbar-border: #0c3b87;
            --window-bg: #ece9d8;
            --window-border: #0054e3;
            --titlebar-bg: linear-gradient(to bottom, #0a246a, #3168d5, #0a246a);
            --titlebar-text: #ffffff;
            --titlebar-inactive: #7a96df;
            --button-bg: #ece9d8;
            --button-border: #7a8a99;
            --button-highlight: #ffffff;
            --content-bg: #ffffff;
            --text-color: #000000;
            --menu-hover: #316ac5;
            --menu-hover-text: #ffffff;
            --start-button-bg: #39b54a;
            --accent-color: #316ac5;
        }

        .theme-dark {
            --desktop-bg: #1a1a2e;
            --taskbar-bg: #16213e;
            --taskbar-border: #0f3460;
            --window-bg: #1a1a2e;
            --window-border: #0f3460;
            --titlebar-bg: #0f3460;
            --titlebar-text: #e94560;
            --titlebar-inactive: #533483;
            --button-bg: #16213e;
            --button-border: #0f3460;
            --button-highlight: #533483;
            --content-bg: #1a1a2e;
            --text-color: #eaeaea;
            --menu-hover: #e94560;
            --menu-hover-text: #ffffff;
            --start-button-bg: #e94560;
            --accent-color: #e94560;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            height: 100vh;
            overflow: hidden;
            background-color: var(--desktop-bg);
            position: relative;
        }

        /* Boot Screen */
        #boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            color: #aaa;
            font-family: 'Courier New', monospace;
            padding: 20px;
            z-index: 10000;
            overflow: hidden;
        }

        #boot-screen.hidden {
            display: none;
        }

        #boot-text {
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.4;
        }

        #boot-loader {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            display: none;
        }

        #boot-loader h2 {
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 300px;
            height: 25px;
            background: #333;
            border: 2px solid #666;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #0066cc, #00aaff);
            transition: width 0.3s;
        }

        /* Login Screen */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #login-screen.show {
            display: flex;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .login-avatar {
            width: 80px;
            height: 80px;
            background: #667eea;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .login-box h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .login-box input {
            width: 200px;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .login-box button {
            padding: 10px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .login-box button:hover {
            background: #5a6fd6;
        }

        #desktop {
            height: calc(100vh - 40px);
            width: 100%;
            position: relative;
            z-index: 1;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        /* Desktop Icons */
        .desktop-icon {
            width: 80px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin: 10px;
            cursor: pointer;
            position: absolute;
            text-align: center;
            border-radius: 5px;
        }

        .desktop-icon .icon-img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .desktop-icon span {
            color: white;
            font-size: 11px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            word-wrap: break-word;
            max-width: 70px;
        }

        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .desktop-icon.selected {
            background-color: rgba(0, 120, 215, 0.4);
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--window-bg);
            border: 1px solid var(--button-border);
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
            z-index: 10000;
            min-width: 180px;
            display: none;
        }

        .context-menu.show {
            display: block;
        }

        .context-menu-item {
            padding: 8px 20px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-color);
        }

        .context-menu-item:hover {
            background: var(--menu-hover);
            color: var(--menu-hover-text);
        }

        .context-menu-separator {
            height: 1px;
            background: var(--button-border);
            margin: 4px 0;
        }

        /* Taskbar */
        #taskbar {
            height: 40px;
            width: 100%;
            background: var(--taskbar-bg);
            position: fixed;
            bottom: 0;
            left: 0;
            display: flex;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            border-top: 2px solid var(--taskbar-border);
        }

        #start-button {
            min-width: 80px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background: var(--start-button-bg);
            color: white;
            cursor: pointer;
            border-right: 1px solid var(--button-border);
            gap: 5px;
            padding: 0 10px;
        }

        #start-button:hover {
            filter: brightness(0.9);
        }

        #taskbar-apps {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 10px;
            overflow-x: auto;
        }

        .taskbar-item {
            padding: 5px 15px;
            margin-right: 5px;
            cursor: pointer;
            border: 1px solid var(--button-border);
            background: var(--button-bg);
            white-space: nowrap;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .taskbar-item.active {
            background: var(--content-bg);
            border-bottom-color: var(--content-bg);
        }

        #system-tray {
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-left: 1px solid var(--button-border);
            gap: 10px;
        }

        .tray-icon {
            cursor: pointer;
            font-size: 14px;
        }

        #clock {
            font-size: 12px;
        }

        /* Start Menu */
        #start-menu {
            position: absolute;
            bottom: 40px;
            left: 0;
            width: 280px;
            background: var(--window-bg);
            border: 2px solid var(--window-border);
            border-bottom: none;
            z-index: 1001;
            box-shadow: 5px -5px 15px rgba(0, 0, 0, 0.3);
            display: none;
        }

        #start-menu.show {
            display: block;
            animation: slideUp 0.15s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .start-menu-header {
            background: var(--titlebar-bg);
            color: var(--titlebar-text);
            padding: 15px;
            font-weight: bold;
            font-size: 16px;
        }

        .start-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-color);
        }

        .start-menu-item:hover {
            background: var(--menu-hover);
            color: var(--menu-hover-text);
        }

        .start-menu-item .icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .start-menu-separator {
            height: 1px;
            background: var(--button-border);
            margin: 5px 0;
        }

        /* Windows */
        .window {
            position: absolute;
            background: var(--window-bg);
            border: 2px solid var(--window-border);
            border-radius: 3px;
            box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            min-width: 200px;
            min-height: 150px;
            z-index: 10;
        }

        .window.minimized {
            display: none;
        }

        .window-titlebar {
            height: 30px;
            background: var(--titlebar-bg);
            display: flex;
            align-items: center;
            padding: 0 5px 0 10px;
            cursor: move;
            user-select: none;
        }

        .window.inactive .window-titlebar {
            background: var(--titlebar-inactive);
        }

        .window-icon {
            font-size: 14px;
            margin-right: 8px;
        }

        .window-title {
            flex: 1;
            color: var(--titlebar-text);
            font-weight: bold;
            font-size: 12px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-control {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--button-bg);
            border: 1px solid var(--button-highlight);
            border-right-color: var(--button-border);
            border-bottom-color: var(--button-border);
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .window-control:hover {
            background: var(--button-highlight);
        }

        .window-control.close:hover {
            background: #e81123;
            color: white;
        }

        .window-menubar {
            background: var(--window-bg);
            border-bottom: 1px solid var(--button-border);
            padding: 2px 5px;
            display: flex;
            gap: 5px;
        }

        .window-menubar span {
            padding: 3px 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .window-menubar span:hover {
            background: var(--menu-hover);
            color: var(--menu-hover-text);
        }

        .window-content {
            flex: 1;
            background: var(--content-bg);
            overflow: auto;
            color: var(--text-color);
        }

        .window-statusbar {
            background: var(--window-bg);
            border-top: 1px solid var(--button-border);
            padding: 3px 10px;
            font-size: 11px;
            color: var(--text-color);
        }

        .resizer {
            width: 15px;
            height: 15px;
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: nwse-resize;
            z-index: 100;
        }

        /* File Explorer */
        .file-explorer {
            display: flex;
            height: 100%;
        }

        .file-sidebar {
            width: 150px;
            background: var(--window-bg);
            border-right: 1px solid var(--button-border);
            padding: 10px;
        }

        .file-sidebar-item {
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 3px;
        }

        .file-sidebar-item:hover {
            background: var(--menu-hover);
            color: var(--menu-hover-text);
        }

        .file-sidebar-item.active {
            background: var(--accent-color);
            color: white;
        }

        .file-list {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            padding: 10px;
            background: var(--content-bg);
        }

        .file-item {
            width: 80px;
            height: 85px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            margin: 5px;
            cursor: pointer;
            text-align: center;
            border-radius: 3px;
        }

        .file-item .file-icon {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .file-item span {
            font-size: 11px;
            word-wrap: break-word;
            max-width: 70px;
            color: var(--text-color);
        }

        .file-item:hover {
            background: rgba(0, 120, 215, 0.1);
        }

        .file-item.selected {
            background: rgba(0, 120, 215, 0.3);
        }

        /* Notepad */
        .notepad-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .notepad-content {
            flex: 1;
            width: 100%;
            resize: none;
            border: none;
            padding: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            background: var(--content-bg);
            color: var(--text-color);
            outline: none;
        }

        /* Calculator */
        .calculator {
            padding: 10px;
            background: var(--window-bg);
            height: 100%;
        }

        .calc-display {
            width: 100%;
            height: 50px;
            background: #9db4a0;
            border: 2px inset var(--button-border);
            margin-bottom: 10px;
            text-align: right;
            padding: 10px;
            font-size: 24px;
            font-family: 'Digital', monospace;
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }

        .calc-btn {
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            background: var(--button-bg);
            border: 2px outset var(--button-border);
            color: var(--text-color);
        }

        .calc-btn:hover {
            background: var(--button-highlight);
        }

        .calc-btn:active {
            border-style: inset;
        }

        .calc-btn.operator {
            background: #e6d5a8;
        }

        .calc-btn.equals {
            background: #a8d5e6;
        }

        .calc-btn.clear {
            background: #e6a8a8;
        }

        /* Terminal */
        .terminal {
            background: #0c0c0c;
            color: #cccccc;
            font-family: 'Consolas', 'Courier New', monospace;
            padding: 10px;
            height: 100%;
            overflow-y: auto;
            font-size: 14px;
        }

        .terminal-line {
            margin-bottom: 2px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
        }

        .terminal-prompt {
            color: #4ec9b0;
            margin-right: 8px;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #cccccc;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }

        /* Paint */
        .paint-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .paint-toolbar {
            display: flex;
            gap: 5px;
            padding: 5px;
            background: var(--window-bg);
            border-bottom: 1px solid var(--button-border);
            flex-wrap: wrap;
        }

        .paint-tool {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid var(--button-border);
            background: var(--button-bg);
            font-size: 16px;
        }

        .paint-tool:hover, .paint-tool.active {
            background: var(--button-highlight);
            border-color: var(--accent-color);
        }

        .paint-colors {
            display: flex;
            gap: 2px;
            margin-left: 10px;
        }

        .paint-color {
            width: 20px;
            height: 20px;
            cursor: pointer;
            border: 1px solid #000;
        }

        .paint-color.active {
            border: 2px solid #fff;
            outline: 2px solid #000;
        }

        .paint-canvas-container {
            flex: 1;
            overflow: auto;
            background: #808080;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .paint-canvas {
            background: white;
            cursor: crosshair;
        }

        /* Settings */
        .settings-container {
            display: flex;
            height: 100%;
        }

        .settings-sidebar {
            width: 180px;
            background: var(--window-bg);
            border-right: 1px solid var(--button-border);
            padding: 10px;
        }

        .settings-sidebar-item {
            padding: 10px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-sidebar-item:hover {
            background: rgba(0,0,0,0.1);
        }

        .settings-sidebar-item.active {
            background: var(--accent-color);
            color: white;
        }

        .settings-content {
            flex: 1;
            padding: 20px;
            background: var(--content-bg);
            overflow-y: auto;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .settings-option {
            margin-bottom: 15px;
        }

        .settings-option label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: var(--text-color);
        }

        .settings-option select, .settings-option input {
            padding: 8px;
            border: 1px solid var(--button-border);
            border-radius: 3px;
            font-size: 13px;
        }

        .theme-preview {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .theme-card {
            width: 100px;
            height: 70px;
            border: 2px solid var(--button-border);
            border-radius: 5px;
            cursor: pointer;
            overflow: hidden;
        }

        .theme-card.active {
            border-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-color);
        }

        .theme-card-preview {
            height: 50px;
        }

        .theme-card-label {
            height: 20px;
            background: var(--window-bg);
            text-align: center;
            font-size: 10px;
            line-height: 20px;
        }

        /* Minesweeper */
        .minesweeper {
            padding: 10px;
            background: var(--window-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mine-header {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            background: #c0c0c0;
            padding: 5px 15px;
            border: 2px inset #808080;
        }

        .mine-counter, .mine-timer {
            background: #000;
            color: #f00;
            font-family: 'Digital', monospace;
            font-size: 24px;
            padding: 2px 8px;
            min-width: 50px;
            text-align: center;
        }

        .mine-reset {
            font-size: 20px;
            cursor: pointer;
            padding: 0 10px;
            background: var(--button-bg);
            border: 2px outset var(--button-border);
        }

        .mine-reset:active {
            border-style: inset;
        }

        .mine-grid {
            display: grid;
            gap: 0;
            border: 3px inset #808080;
        }

        .mine-cell {
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            background: #c0c0c0;
            border: 2px outset #fff;
            user-select: none;
        }

        .mine-cell.revealed {
            border: 1px solid #808080;
            background: #d0d0d0;
        }

        .mine-cell.mine {
            background: #ff0000;
        }

        .mine-cell.flagged::after {
            content: "üö©";
        }

        .mine-cell[data-count="1"] { color: #0000ff; }
        .mine-cell[data-count="2"] { color: #008000; }
        .mine-cell[data-count="3"] { color: #ff0000; }
        .mine-cell[data-count="4"] { color: #000080; }
        .mine-cell[data-count="5"] { color: #800000; }
        .mine-cell[data-count="6"] { color: #008080; }
        .mine-cell[data-count="7"] { color: #000000; }
        .mine-cell[data-count="8"] { color: #808080; }

        /* Solitaire */
        .solitaire {
            background: #008000;
            height: 100%;
            padding: 10px;
            overflow: auto;
        }

        .solitaire-top {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .solitaire-deck, .solitaire-foundations {
            display: flex;
            gap: 10px;
        }

        .card-slot {
            width: 70px;
            height: 95px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: rgba(255,255,255,0.3);
        }

        .card {
            width: 70px;
            height: 95px;
            background: white;
            border-radius: 5px;
            border: 1px solid #000;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            position: relative;
            user-select: none;
        }

        .card.red {
            color: #cc0000;
        }

        .card.black {
            color: #000;
        }

        .card.face-down {
            background: linear-gradient(45deg, #1a4d8f, #2e6bb5);
            background-size: 10px 10px;
        }

        .card.face-down::after {
            content: "";
            position: absolute;
            inset: 5px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .solitaire-tableau {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .tableau-pile {
            width: 70px;
            min-height: 95px;
            position: relative;
        }

        .tableau-pile .card {
            position: absolute;
            left: 0;
        }

        /* Notifications */
        #notification-container {
            position: fixed;
            bottom: 50px;
            right: 10px;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: var(--window-bg);
            border: 1px solid var(--button-border);
            border-left: 4px solid var(--accent-color);
            padding: 15px 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .notification-body {
            font-size: 12px;
            color: #666;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Task Manager */
        .task-manager {
            padding: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .task-list {
            flex: 1;
            border: 1px solid var(--button-border);
            background: var(--content-bg);
            overflow-y: auto;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            border-bottom: 1px solid var(--button-border);
            font-size: 12px;
        }

        .task-item:hover {
            background: rgba(0,0,0,0.05);
        }

        .task-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            padding: 10px;
            background: var(--window-bg);
            border: 1px solid var(--button-border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 11px;
            color: #666;
        }

        /* Music Player */
        .music-player {
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            height: 100%;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .music-artwork {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #e94560, #533483);
            border-radius: 10px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }

        .music-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .music-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .music-artist {
            font-size: 14px;
            color: #aaa;
        }

        .music-progress {
            height: 5px;
            background: #333;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .music-progress-fill {
            height: 100%;
            background: #e94560;
            border-radius: 5px;
            width: 35%;
        }

        .music-time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #aaa;
            margin-bottom: 20px;
        }

        .music-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .music-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: #333;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .music-btn.play {
            width: 60px;
            height: 60px;
            background: #e94560;
        }

        .music-btn:hover {
            filter: brightness(1.2);
        }

        .music-volume {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .music-volume input {
            width: 100px;
        }

        /* Image Viewer */
        .image-viewer {
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
        }

        .image-viewer-toolbar {
            padding: 10px;
            background: #2a2a2a;
            display: flex;
            gap: 10px;
        }

        .image-viewer-btn {
            padding: 5px 15px;
            background: #444;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .image-viewer-btn:hover {
            background: #555;
        }

        .image-viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .image-viewer-content img {
            max-width: 100%;
            max-height: 100%;
        }

        /* Animations */
        .window-opening {
            animation: windowOpen 0.2s ease-out;
        }

        @keyframes windowOpen {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .window-closing {
            animation: windowClose 0.15s ease-in forwards;
        }

        @keyframes windowClose {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0; }
        }

        /* Snapping indicators */
        .snap-indicator {
            position: fixed;
            background: rgba(0, 120, 215, 0.3);
            border: 2px solid rgba(0, 120, 215, 0.6);
            z-index: 999;
            display: none;
            pointer-events: none;
        }

        /* Browser */
        .browser-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .browser-toolbar {
            display: flex;
            gap: 5px;
            padding: 8px;
            background: var(--window-bg);
            border-bottom: 1px solid var(--button-border);
        }

        .browser-nav-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--button-border);
            background: var(--button-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .browser-address {
            flex: 1;
            padding: 5px 10px;
            border: 1px solid var(--button-border);
            font-size: 13px;
        }

        .browser-go {
            padding: 5px 15px;
            background: var(--accent-color);
            color: white;
            border: none;
            cursor: pointer;
        }

        .browser-content {
            flex: 1;
            background: white;
            overflow: auto;
            padding: 20px;
        }
    </style>
</head>
<body>
    <!-- Boot Screen -->
    <div id="boot-screen">
        <div id="boot-text"></div>
        <div id="boot-loader">
            <h2>Starting Web OS...</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="boot-progress"></div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <div class="login-avatar">üë§</div>
            <h2 id="login-username">User</h2>
            <input type="password" id="login-password" placeholder="Password (any key)">
            <br>
            <button id="login-btn">Sign In</button>
        </div>
    </div>

    <!-- Desktop -->
    <div id="desktop"></div>

    <!-- Taskbar -->
    <div id="taskbar">
        <div id="start-button">
            <span>ü™ü</span>
            <span>Start</span>
        </div>
        <div id="taskbar-apps"></div>
        <div id="system-tray">
            <span class="tray-icon" id="sound-toggle" title="Sound">üîä</span>
            <span class="tray-icon" id="notification-icon" title="Notifications">üîî</span>
            <span id="clock">12:00 PM</span>
        </div>
    </div>

    <!-- Start Menu -->
    <div id="start-menu">
        <div class="start-menu-header">Web OS</div>
        <div class="start-menu-item" data-app="file-explorer">
            <span class="icon">üìÅ</span> File Explorer
        </div>
        <div class="start-menu-item" data-app="notepad">
            <span class="icon">üìù</span> Notepad
        </div>
        <div class="start-menu-item" data-app="calculator">
            <span class="icon">üî¢</span> Calculator
        </div>
        <div class="start-menu-item" data-app="terminal">
            <span class="icon">üíª</span> Terminal
        </div>
        <div class="start-menu-item" data-app="browser">
            <span class="icon">üåê</span> Browser
        </div>
        <div class="start-menu-item" data-app="paint">
            <span class="icon">üé®</span> Paint
        </div>
        <div class="start-menu-item" data-app="music">
            <span class="icon">üéµ</span> Music Player
        </div>
        <div class="start-menu-separator"></div>
        <div class="start-menu-item" data-app="minesweeper">
            <span class="icon">üí£</span> Minesweeper
        </div>
        <div class="start-menu-item" data-app="solitaire">
            <span class="icon">üÉè</span> Solitaire
        </div>
        <div class="start-menu-separator"></div>
        <div class="start-menu-item" data-app="settings">
            <span class="icon">‚öôÔ∏è</span> Settings
        </div>
        <div class="start-menu-item" data-app="task-manager">
            <span class="icon">üìä</span> Task Manager
        </div>
        <div class="start-menu-separator"></div>
        <div class="start-menu-item" id="power-button">
            <span class="icon">‚ö°</span> Shut Down
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu"></div>

    <!-- Snap Indicator -->
    <div class="snap-indicator" id="snap-indicator"></div>

    <!-- Notifications -->
    <div id="notification-container"></div>

    <script>
        // ==================== CORE OS ====================
        const OS = {
            windows: [],
            nextZIndex: 10,
            nextWindowId: 1,
            activeWindow: null,
            soundEnabled: true,
            theme: 'default',
            wallpaper: '',
            fileSystem: null,
            clipboard: null,
            desktopIcons: []
        };

        // ==================== FILE SYSTEM ====================
        class FileSystem {
            constructor() {
                this.load();
            }

            getDefaultFS() {
                return {
                    'Desktop': {
                        type: 'folder',
                        children: {
                            'README.txt': { type: 'file', content: 'Welcome to Web OS!\n\nThis is your desktop.' }
                        }
                    },
                    'Documents': {
                        type: 'folder',
                        children: {
                            'Notes.txt': { type: 'file', content: 'My important notes...' },
                            'Todo.txt': { type: 'file', content: '- Learn Web OS\n- Have fun!' }
                        }
                    },
                    'Pictures': {
                        type: 'folder',
                        children: {}
                    },
                    'Music': {
                        type: 'folder',
                        children: {
                            'playlist.txt': { type: 'file', content: 'My favorite songs:\n1. Song A\n2. Song B' }
                        }
                    },
                    'Downloads': {
                        type: 'folder',
                        children: {}
                    }
                };
            }

            load() {
                const saved = localStorage.getItem('webos-filesystem');
                this.data = saved ? JSON.parse(saved) : this.getDefaultFS();
            }

            save() {
                localStorage.setItem('webos-filesystem', JSON.stringify(this.data));
            }

            getFolder(path) {
                if (path === '/' || path === '') return this.data;
                const parts = path.split('/').filter(p => p);
                let current = this.data;
                for (const part of parts) {
                    if (current[part] && current[part].type === 'folder') {
                        current = current[part].children;
                    } else {
                        return null;
                    }
                }
                return current;
            }

            getFile(path) {
                const parts = path.split('/').filter(p => p);
                const fileName = parts.pop();
                const folder = this.getFolder(parts.join('/'));
                return folder ? folder[fileName] : null;
            }

            createFile(path, name, content = '') {
                const folder = this.getFolder(path);
                if (folder) {
                    folder[name] = { type: 'file', content };
                    this.save();
                    return true;
                }
                return false;
            }

            createFolder(path, name) {
                const folder = this.getFolder(path);
                if (folder) {
                    folder[name] = { type: 'folder', children: {} };
                    this.save();
                    return true;
                }
                return false;
            }

            deleteItem(path, name) {
                const folder = this.getFolder(path);
                if (folder && folder[name]) {
                    delete folder[name];
                    this.save();
                    return true;
                }
                return false;
            }

            renameItem(path, oldName, newName) {
                const folder = this.getFolder(path);
                if (folder && folder[oldName]) {
                    folder[newName] = folder[oldName];
                    delete folder[oldName];
                    this.save();
                    return true;
                }
                return false;
            }

            updateFile(path, content) {
                const parts = path.split('/').filter(p => p);
                const fileName = parts.pop();
                const folder = this.getFolder(parts.join('/'));
                if (folder && folder[fileName]) {
                    folder[fileName].content = content;
                    this.save();
                    return true;
                }
                return false;
            }
        }

        // ==================== NOTIFICATIONS ====================
        function showNotification(title, body, duration = 4000) {
            const container = document.getElementById('notification-container');
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-body">${body}</div>
            `;
            container.appendChild(notif);

            if (OS.soundEnabled) playSound('notification');

            setTimeout(() => {
                notif.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notif.remove(), 300);
            }, duration);
        }

        // ==================== SOUND SYSTEM ====================
        function playSound(type) {
            if (!OS.soundEnabled) return;
            // Using Web Audio API for simple sounds
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = ctx.createOscillator();
            const gain = ctx.createGain();

            oscillator.connect(gain);
            gain.connect(ctx.destination);

            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    gain.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.05);
                    break;
                case 'notification':
                    oscillator.frequency.value = 600;
                    gain.gain.value = 0.1;
                    oscillator.start();
                    setTimeout(() => oscillator.frequency.value = 800, 100);
                    oscillator.stop(ctx.currentTime + 0.2);
                    break;
                case 'error':
                    oscillator.frequency.value = 200;
                    gain.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.3);
                    break;
                case 'startup':
                    oscillator.type = 'sine';
                    gain.gain.value = 0.1;
                    oscillator.frequency.setValueAtTime(400, ctx.currentTime);
                    oscillator.frequency.linearRampToValueAtTime(600, ctx.currentTime + 0.2);
                    oscillator.frequency.linearRampToValueAtTime(800, ctx.currentTime + 0.4);
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.5);
                    break;
            }
        }

        // ==================== BOOT SEQUENCE ====================
        async function bootSequence() {
            const bootScreen = document.getElementById('boot-screen');
            const bootText = document.getElementById('boot-text');
            const bootLoader = document.getElementById('boot-loader');
            const bootProgress = document.getElementById('boot-progress');

            const bootMessages = [
                'Web OS BIOS v1.0',
                'Copyright (c) 2025 Web OS Corporation',
                '',
                'Checking system memory... 16384 MB OK',
                'Detecting storage devices...',
                '  - Virtual HDD: 1TB',
                '  - Virtual SSD: 512GB',
                '',
                'Initializing file system...',
                'Loading device drivers...',
                'Starting Web OS kernel...',
                ''
            ];

            for (const msg of bootMessages) {
                bootText.textContent += msg + '\n';
                await new Promise(r => setTimeout(r, 100));
            }

            await new Promise(r => setTimeout(r, 500));
            bootText.style.display = 'none';
            bootLoader.style.display = 'block';

            for (let i = 0; i <= 100; i += 2) {
                bootProgress.style.width = i + '%';
                await new Promise(r => setTimeout(r, 30));
            }

            await new Promise(r => setTimeout(r, 300));
            bootScreen.classList.add('hidden');

            playSound('startup');
            showLoginScreen();
        }

        function showLoginScreen() {
            const loginScreen = document.getElementById('login-screen');
            const savedUser = localStorage.getItem('webos-username') || 'User';
            document.getElementById('login-username').textContent = savedUser;
            loginScreen.classList.add('show');

            document.getElementById('login-btn').onclick = doLogin;
            document.getElementById('login-password').onkeydown = (e) => {
                if (e.key === 'Enter') doLogin();
            };
        }

        function doLogin() {
            document.getElementById('login-screen').classList.remove('show');
            initDesktop();
            showNotification('Welcome!', 'You are now logged in to Web OS.');
        }

        // ==================== DESKTOP INITIALIZATION ====================
        function initDesktop() {
            OS.fileSystem = new FileSystem();

            // Load settings
            OS.theme = localStorage.getItem('webos-theme') || 'default';
            OS.wallpaper = localStorage.getItem('webos-wallpaper') || '';
            OS.soundEnabled = localStorage.getItem('webos-sound') !== 'false';

            applyTheme(OS.theme);
            if (OS.wallpaper) {
                document.getElementById('desktop').style.backgroundImage = `url(${OS.wallpaper})`;
            }

            updateSoundIcon();
            setupDesktopIcons();
            setupEventListeners();
            updateClock();
            setInterval(updateClock, 1000);
        }

        function applyTheme(theme) {
            document.body.className = '';
            if (theme === 'xp') document.body.classList.add('theme-xp');
            else if (theme === 'dark') document.body.classList.add('theme-dark');
            OS.theme = theme;
            localStorage.setItem('webos-theme', theme);
        }

        function setupDesktopIcons() {
            const desktop = document.getElementById('desktop');
            desktop.innerHTML = '';

            const icons = [
                { id: 'file-explorer', name: 'Files', icon: 'üìÅ', top: 20, left: 20 },
                { id: 'notepad', name: 'Notepad', icon: 'üìù', top: 120, left: 20 },
                { id: 'browser', name: 'Browser', icon: 'üåê', top: 220, left: 20 },
                { id: 'calculator', name: 'Calculator', icon: 'üî¢', top: 320, left: 20 },
                { id: 'terminal', name: 'Terminal', icon: 'üíª', top: 420, left: 20 },
                { id: 'paint', name: 'Paint', icon: 'üé®', top: 20, left: 110 },
                { id: 'minesweeper', name: 'Minesweeper', icon: 'üí£', top: 120, left: 110 },
                { id: 'solitaire', name: 'Solitaire', icon: 'üÉè', top: 220, left: 110 },
                { id: 'settings', name: 'Settings', icon: '‚öôÔ∏è', top: 320, left: 110 }
            ];

            icons.forEach(app => {
                const icon = document.createElement('div');
                icon.className = 'desktop-icon';
                icon.setAttribute('data-app', app.id);
                icon.style.top = app.top + 'px';
                icon.style.left = app.left + 'px';
                icon.innerHTML = `
                    <div class="icon-img">${app.icon}</div>
                    <span>${app.name}</span>
                `;

                icon.addEventListener('dblclick', () => launchApp(app.id));
                icon.addEventListener('contextmenu', (e) => showContextMenu(e, 'icon', app.id));
                makeDraggable(icon);

                desktop.appendChild(icon);
            });

            // Desktop context menu
            desktop.addEventListener('contextmenu', (e) => {
                if (e.target === desktop) {
                    showContextMenu(e, 'desktop');
                }
            });
        }

        // ==================== CONTEXT MENU ====================
        function showContextMenu(e, type, data = null) {
            e.preventDefault();
            const menu = document.getElementById('context-menu');
            let items = [];

            switch(type) {
                case 'desktop':
                    items = [
                        { label: 'üìÅ New Folder', action: () => createNewFolder() },
                        { label: 'üìÑ New Text File', action: () => createNewFile() },
                        { separator: true },
                        { label: 'üîÑ Refresh', action: () => setupDesktopIcons() },
                        { separator: true },
                        { label: 'üé® Personalize', action: () => launchApp('settings') },
                        { label: '‚öôÔ∏è Display Settings', action: () => launchApp('settings') }
                    ];
                    break;
                case 'icon':
                    items = [
                        { label: '‚ñ∂Ô∏è Open', action: () => launchApp(data) },
                        { separator: true },
                        { label: 'üóëÔ∏è Delete', action: () => showNotification('Info', 'System icons cannot be deleted') }
                    ];
                    break;
                case 'file':
                    items = [
                        { label: '‚ñ∂Ô∏è Open', action: () => data.onOpen && data.onOpen() },
                        { separator: true },
                        { label: '‚úèÔ∏è Rename', action: () => data.onRename && data.onRename() },
                        { label: 'üìã Copy', action: () => { OS.clipboard = data; } },
                        { separator: true },
                        { label: 'üóëÔ∏è Delete', action: () => data.onDelete && data.onDelete() }
                    ];
                    break;
            }

            menu.innerHTML = items.map(item => {
                if (item.separator) return '<div class="context-menu-separator"></div>';
                return `<div class="context-menu-item">${item.label}</div>`;
            }).join('');

            menu.querySelectorAll('.context-menu-item').forEach((el, i) => {
                const item = items.filter(it => !it.separator)[i];
                if (item) el.onclick = () => {
                    item.action();
                    menu.classList.remove('show');
                };
            });

            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
            menu.classList.add('show');
        }

        function createNewFolder() {
            const name = prompt('Enter folder name:', 'New Folder');
            if (name) {
                OS.fileSystem.createFolder('Desktop', name);
                showNotification('Folder Created', `"${name}" has been created.`);
            }
        }

        function createNewFile() {
            const name = prompt('Enter file name:', 'New File.txt');
            if (name) {
                OS.fileSystem.createFile('Desktop', name, '');
                showNotification('File Created', `"${name}" has been created.`);
            }
        }

        // ==================== EVENT LISTENERS ====================
        function setupEventListeners() {
            // Start button
            document.getElementById('start-button').onclick = toggleStartMenu;

            // Power button
            document.getElementById('power-button').onclick = shutDown;

            // Start menu items
            document.querySelectorAll('.start-menu-item[data-app]').forEach(item => {
                item.onclick = function() {
                    launchApp(this.getAttribute('data-app'));
                    document.getElementById('start-menu').classList.remove('show');
                };
            });

            // Close context menu on click
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.context-menu')) {
                    document.getElementById('context-menu').classList.remove('show');
                }
                if (!e.target.closest('#start-menu') && !e.target.closest('#start-button')) {
                    document.getElementById('start-menu').classList.remove('show');
                }
            });

            // Sound toggle
            document.getElementById('sound-toggle').onclick = () => {
                OS.soundEnabled = !OS.soundEnabled;
                localStorage.setItem('webos-sound', OS.soundEnabled);
                updateSoundIcon();
                if (OS.soundEnabled) playSound('click');
            };

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        function handleKeyboardShortcuts(e) {
            // Alt+F4 - Close window
            if (e.altKey && e.key === 'F4') {
                e.preventDefault();
                if (OS.activeWindow) closeWindow(OS.activeWindow);
            }
            // Alt+Tab - Not implemented (browser conflict)
            // Win key - Start menu
            if (e.key === 'Meta') {
                e.preventDefault();
                toggleStartMenu();
            }
        }

        function updateSoundIcon() {
            document.getElementById('sound-toggle').textContent = OS.soundEnabled ? 'üîä' : 'üîá';
        }

        function updateClock() {
            const now = new Date();
            const hours = now.getHours() % 12 || 12;
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            document.getElementById('clock').textContent = `${hours}:${minutes} ${ampm}`;
        }

        function toggleStartMenu() {
            const menu = document.getElementById('start-menu');
            menu.classList.toggle('show');
            if (OS.soundEnabled && menu.classList.contains('show')) playSound('click');
        }

        function shutDown() {
            if (confirm('Are you sure you want to shut down?')) {
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #000080; color: white; flex-direction: column;">
                        <h1>Shutting Down...</h1>
                        <p style="margin-top: 20px;">It is now safe to close this window.</p>
                    </div>
                `;
            }
        }

        // ==================== WINDOW MANAGEMENT ====================
        function launchApp(appName) {
            // Check if already open
            const existing = OS.windows.find(w => w.appId === appName);
            if (existing) {
                focusWindow(existing.id);
                return;
            }

            let config = getAppConfig(appName);
            createWindow(config);
        }

        function getAppConfig(appName) {
            const configs = {
                'file-explorer': {
                    id: 'file-explorer',
                    title: 'File Explorer',
                    icon: 'üìÅ',
                    width: 600,
                    height: 400,
                    content: createFileExplorer
                },
                'notepad': {
                    id: 'notepad',
                    title: 'Untitled - Notepad',
                    icon: 'üìù',
                    width: 500,
                    height: 400,
                    menubar: ['File', 'Edit', 'View', 'Help'],
                    content: createNotepad
                },
                'calculator': {
                    id: 'calculator',
                    title: 'Calculator',
                    icon: 'üî¢',
                    width: 250,
                    height: 350,
                    resizable: false,
                    content: createCalculator
                },
                'terminal': {
                    id: 'terminal',
                    title: 'Terminal',
                    icon: 'üíª',
                    width: 600,
                    height: 400,
                    content: createTerminal
                },
                'browser': {
                    id: 'browser',
                    title: 'Web Browser',
                    icon: 'üåê',
                    width: 700,
                    height: 500,
                    content: createBrowser
                },
                'paint': {
                    id: 'paint',
                    title: 'Paint',
                    icon: 'üé®',
                    width: 700,
                    height: 500,
                    content: createPaint
                },
                'music': {
                    id: 'music',
                    title: 'Music Player',
                    icon: 'üéµ',
                    width: 350,
                    height: 450,
                    resizable: false,
                    content: createMusicPlayer
                },
                'minesweeper': {
                    id: 'minesweeper',
                    title: 'Minesweeper',
                    icon: 'üí£',
                    width: 300,
                    height: 380,
                    resizable: false,
                    content: createMinesweeper
                },
                'solitaire': {
                    id: 'solitaire',
                    title: 'Solitaire',
                    icon: 'üÉè',
                    width: 700,
                    height: 550,
                    content: createSolitaire
                },
                'settings': {
                    id: 'settings',
                    title: 'Settings',
                    icon: '‚öôÔ∏è',
                    width: 600,
                    height: 450,
                    content: createSettings
                },
                'task-manager': {
                    id: 'task-manager',
                    title: 'Task Manager',
                    icon: 'üìä',
                    width: 400,
                    height: 350,
                    content: createTaskManager
                },
                'image-viewer': {
                    id: 'image-viewer',
                    title: 'Image Viewer',
                    icon: 'üñºÔ∏è',
                    width: 600,
                    height: 450,
                    content: createImageViewer
                }
            };
            return configs[appName] || { id: appName, title: appName, icon: 'üì¶', width: 400, height: 300, content: () => document.createElement('div') };
        }

        function createWindow(config) {
            const windowId = 'window-' + OS.nextWindowId++;

            const win = document.createElement('div');
            win.className = 'window window-opening';
            win.id = windowId;
            win.style.width = config.width + 'px';
            win.style.height = config.height + 'px';
            win.style.left = (100 + Math.random() * 100) + 'px';
            win.style.top = (50 + Math.random() * 100) + 'px';
            win.style.zIndex = OS.nextZIndex++;

            // Title bar
            const titlebar = document.createElement('div');
            titlebar.className = 'window-titlebar';
            titlebar.innerHTML = `
                <span class="window-icon">${config.icon}</span>
                <span class="window-title">${config.title}</span>
                <div class="window-controls">
                    <div class="window-control minimize" title="Minimize">‚àí</div>
                    <div class="window-control maximize" title="Maximize">‚ñ°</div>
                    <div class="window-control close" title="Close">√ó</div>
                </div>
            `;

            // Menu bar
            if (config.menubar) {
                const menubar = document.createElement('div');
                menubar.className = 'window-menubar';
                config.menubar.forEach(item => {
                    const span = document.createElement('span');
                    span.textContent = item;
                    menubar.appendChild(span);
                });
                win.appendChild(titlebar);
                win.appendChild(menubar);
            } else {
                win.appendChild(titlebar);
            }

            // Content
            const content = document.createElement('div');
            content.className = 'window-content';
            const appContent = config.content();
            content.appendChild(appContent);
            win.appendChild(content);

            // Status bar
            if (config.statusbar !== false) {
                const statusbar = document.createElement('div');
                statusbar.className = 'window-statusbar';
                statusbar.textContent = 'Ready';
                win.appendChild(statusbar);
            }

            // Resizer
            if (config.resizable !== false) {
                const resizer = document.createElement('div');
                resizer.className = 'resizer';
                win.appendChild(resizer);
                makeResizable(win, resizer);
            }

            // Event listeners
            titlebar.querySelector('.minimize').onclick = () => minimizeWindow(windowId);
            titlebar.querySelector('.maximize').onclick = () => maximizeWindow(windowId);
            titlebar.querySelector('.close').onclick = () => closeWindow(windowId);

            win.addEventListener('mousedown', () => focusWindow(windowId));

            makeDraggable(win, titlebar, true);

            document.getElementById('desktop').appendChild(win);
            addToTaskbar(windowId, config.title, config.icon, config.id);

            OS.windows.push({
                id: windowId,
                appId: config.id,
                title: config.title,
                minimized: false,
                maximized: false
            });

            focusWindow(windowId);
            setTimeout(() => win.classList.remove('window-opening'), 200);

            return windowId;
        }

        function addToTaskbar(windowId, title, icon, appId) {
            const item = document.createElement('div');
            item.className = 'taskbar-item';
            item.setAttribute('data-window', windowId);
            item.innerHTML = `<span>${icon}</span><span>${title}</span>`;
            item.onclick = () => {
                const win = OS.windows.find(w => w.id === windowId);
                if (win.minimized) {
                    restoreWindow(windowId);
                } else if (OS.activeWindow === windowId) {
                    minimizeWindow(windowId);
                } else {
                    focusWindow(windowId);
                }
            };
            document.getElementById('taskbar-apps').appendChild(item);
        }

        function focusWindow(windowId) {
            // Update all windows
            document.querySelectorAll('.window').forEach(w => w.classList.add('inactive'));
            const win = document.getElementById(windowId);
            if (win) {
                win.classList.remove('inactive');
                win.style.zIndex = OS.nextZIndex++;
            }

            // Update taskbar
            document.querySelectorAll('.taskbar-item').forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-window') === windowId);
            });

            OS.activeWindow = windowId;
        }

        function minimizeWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) {
                win.classList.add('minimized');
                const winData = OS.windows.find(w => w.id === windowId);
                if (winData) winData.minimized = true;
            }
            document.querySelector(`.taskbar-item[data-window="${windowId}"]`)?.classList.remove('active');
        }

        function restoreWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) {
                win.classList.remove('minimized');
                const winData = OS.windows.find(w => w.id === windowId);
                if (winData) winData.minimized = false;
                focusWindow(windowId);
            }
        }

        function maximizeWindow(windowId) {
            const win = document.getElementById(windowId);
            const winData = OS.windows.find(w => w.id === windowId);
            if (!win || !winData) return;

            if (winData.maximized) {
                // Restore
                win.style.top = winData.prevState.top;
                win.style.left = winData.prevState.left;
                win.style.width = winData.prevState.width;
                win.style.height = winData.prevState.height;
                winData.maximized = false;
            } else {
                // Maximize
                winData.prevState = {
                    top: win.style.top,
                    left: win.style.left,
                    width: win.style.width,
                    height: win.style.height
                };
                win.style.top = '0';
                win.style.left = '0';
                win.style.width = '100%';
                win.style.height = 'calc(100vh - 40px)';
                winData.maximized = true;
            }
        }

        function closeWindow(windowId) {
            const win = document.getElementById(windowId);
            if (win) {
                win.classList.add('window-closing');
                setTimeout(() => win.remove(), 150);
            }
            document.querySelector(`.taskbar-item[data-window="${windowId}"]`)?.remove();
            OS.windows = OS.windows.filter(w => w.id !== windowId);
            if (OS.activeWindow === windowId) OS.activeWindow = null;
        }

        // ==================== DRAGGING & RESIZING ====================
        function makeDraggable(element, handle = null, isWindow = false) {
            const dragHandle = handle || element;
            let isDragging = false;
            let startX, startY, startLeft, startTop;

            dragHandle.addEventListener('mousedown', startDrag);

            function startDrag(e) {
                if (e.target.closest('.window-control')) return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startLeft = element.offsetLeft;
                startTop = element.offsetTop;

                document.addEventListener('mousemove', doDrag);
                document.addEventListener('mouseup', stopDrag);
                e.preventDefault();
            }

            function doDrag(e) {
                if (!isDragging) return;

                const dx = e.clientX - startX;
                const dy = e.clientY - startY;

                element.style.left = (startLeft + dx) + 'px';
                element.style.top = (startTop + dy) + 'px';

                // Window snapping
                if (isWindow) {
                    const snapIndicator = document.getElementById('snap-indicator');
                    if (e.clientX <= 5) {
                        snapIndicator.style.display = 'block';
                        snapIndicator.style.left = '0';
                        snapIndicator.style.top = '0';
                        snapIndicator.style.width = '50%';
                        snapIndicator.style.height = 'calc(100vh - 40px)';
                    } else if (e.clientX >= window.innerWidth - 5) {
                        snapIndicator.style.display = 'block';
                        snapIndicator.style.left = '50%';
                        snapIndicator.style.top = '0';
                        snapIndicator.style.width = '50%';
                        snapIndicator.style.height = 'calc(100vh - 40px)';
                    } else if (e.clientY <= 5) {
                        snapIndicator.style.display = 'block';
                        snapIndicator.style.left = '0';
                        snapIndicator.style.top = '0';
                        snapIndicator.style.width = '100%';
                        snapIndicator.style.height = 'calc(100vh - 40px)';
                    } else {
                        snapIndicator.style.display = 'none';
                    }
                }
            }

            function stopDrag(e) {
                if (!isDragging) return;
                isDragging = false;

                document.removeEventListener('mousemove', doDrag);
                document.removeEventListener('mouseup', stopDrag);

                // Apply snap
                if (isWindow) {
                    const snapIndicator = document.getElementById('snap-indicator');
                    if (snapIndicator.style.display === 'block') {
                        element.style.left = snapIndicator.style.left;
                        element.style.top = snapIndicator.style.top;
                        element.style.width = snapIndicator.style.width;
                        element.style.height = snapIndicator.style.height;
                    }
                    snapIndicator.style.display = 'none';
                }
            }
        }

        function makeResizable(element, handle) {
            let isResizing = false;
            let startX, startY, startWidth, startHeight;

            handle.addEventListener('mousedown', startResize);

            function startResize(e) {
                isResizing = true;
                startX = e.clientX;
                startY = e.clientY;
                startWidth = element.offsetWidth;
                startHeight = element.offsetHeight;

                document.addEventListener('mousemove', doResize);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault();
            }

            function doResize(e) {
                if (!isResizing) return;
                const width = startWidth + (e.clientX - startX);
                const height = startHeight + (e.clientY - startY);
                if (width >= 200) element.style.width = width + 'px';
                if (height >= 150) element.style.height = height + 'px';
            }

            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', doResize);
                document.removeEventListener('mouseup', stopResize);
            }
        }

        // ==================== APP: FILE EXPLORER ====================
        function createFileExplorer() {
            const container = document.createElement('div');
            container.className = 'file-explorer';

            let currentPath = '/';

            const sidebar = document.createElement('div');
            sidebar.className = 'file-sidebar';

            const folders = ['Desktop', 'Documents', 'Pictures', 'Music', 'Downloads'];
            folders.forEach(folder => {
                const item = document.createElement('div');
                item.className = 'file-sidebar-item';
                item.innerHTML = `üìÅ ${folder}`;
                item.onclick = () => {
                    sidebar.querySelectorAll('.file-sidebar-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentPath = folder;
                    renderFiles();
                };
                sidebar.appendChild(item);
            });

            const fileList = document.createElement('div');
            fileList.className = 'file-list';

            function renderFiles() {
                fileList.innerHTML = '';
                const folder = OS.fileSystem.getFolder(currentPath);
                if (!folder) return;

                Object.entries(folder).forEach(([name, item]) => {
                    const fileEl = document.createElement('div');
                    fileEl.className = 'file-item';
                    const icon = item.type === 'folder' ? 'üìÅ' : (name.endsWith('.txt') ? 'üìÑ' : 'üì¶');
                    fileEl.innerHTML = `
                        <div class="file-icon">${icon}</div>
                        <span>${name}</span>
                    `;
                    fileEl.ondblclick = () => {
                        if (item.type === 'folder') {
                            currentPath = currentPath + '/' + name;
                            renderFiles();
                        } else if (name.endsWith('.txt')) {
                            openFileInNotepad(currentPath + '/' + name, item.content);
                        }
                    };
                    fileEl.oncontextmenu = (e) => {
                        showContextMenu(e, 'file', {
                            path: currentPath,
                            name: name,
                            onDelete: () => {
                                OS.fileSystem.deleteItem(currentPath, name);
                                renderFiles();
                            },
                            onRename: () => {
                                const newName = prompt('New name:', name);
                                if (newName && newName !== name) {
                                    OS.fileSystem.renameItem(currentPath, name, newName);
                                    renderFiles();
                                }
                            }
                        });
                    };
                    fileList.appendChild(fileEl);
                });
            }

            container.appendChild(sidebar);
            container.appendChild(fileList);

            setTimeout(() => {
                sidebar.querySelector('.file-sidebar-item').click();
            }, 0);

            return container;
        }

        function openFileInNotepad(path, content) {
            const existing = OS.windows.find(w => w.appId === 'notepad');
            if (existing) closeWindow(existing.id);

            const config = getAppConfig('notepad');
            config.title = path.split('/').pop() + ' - Notepad';
            config.filePath = path;
            config.fileContent = content;
            createWindow(config);
        }

        // ==================== APP: NOTEPAD ====================
        function createNotepad() {
            const container = document.createElement('div');
            container.className = 'notepad-container';

            const textarea = document.createElement('textarea');
            textarea.className = 'notepad-content';
            textarea.placeholder = 'Type here...';

            // Check if opening a file
            const config = getAppConfig('notepad');
            if (config.fileContent !== undefined) {
                textarea.value = config.fileContent;
            }

            container.appendChild(textarea);
            return container;
        }

        // ==================== APP: CALCULATOR ====================
        function createCalculator() {
            const container = document.createElement('div');
            container.className = 'calculator';

            let display = '0';
            let currentValue = null;
            let operator = null;
            let waitingForOperand = false;

            const displayEl = document.createElement('div');
            displayEl.className = 'calc-display';
            displayEl.textContent = display;

            const buttons = [
                ['C', '¬±', '%', '√∑'],
                ['7', '8', '9', '√ó'],
                ['4', '5', '6', '-'],
                ['1', '2', '3', '+'],
                ['0', '.', '=']
            ];

            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'calc-buttons';

            buttons.flat().forEach(btn => {
                const button = document.createElement('button');
                button.className = 'calc-btn';
                button.textContent = btn;

                if (['√∑', '√ó', '-', '+'].includes(btn)) button.classList.add('operator');
                if (btn === '=') button.classList.add('equals');
                if (btn === 'C') button.classList.add('clear');
                if (btn === '0') button.style.gridColumn = 'span 2';

                button.onclick = () => {
                    if (OS.soundEnabled) playSound('click');

                    if (btn >= '0' && btn <= '9' || btn === '.') {
                        if (waitingForOperand) {
                            display = btn;
                            waitingForOperand = false;
                        } else {
                            display = display === '0' ? btn : display + btn;
                        }
                    } else if (btn === 'C') {
                        display = '0';
                        currentValue = null;
                        operator = null;
                        waitingForOperand = false;
                    } else if (btn === '¬±') {
                        display = String(-parseFloat(display));
                    } else if (btn === '%') {
                        display = String(parseFloat(display) / 100);
                    } else if (['√∑', '√ó', '-', '+'].includes(btn)) {
                        currentValue = parseFloat(display);
                        operator = btn;
                        waitingForOperand = true;
                    } else if (btn === '=' && operator && currentValue !== null) {
                        const current = parseFloat(display);
                        let result;
                        switch(operator) {
                            case '+': result = currentValue + current; break;
                            case '-': result = currentValue - current; break;
                            case '√ó': result = currentValue * current; break;
                            case '√∑': result = currentValue / current; break;
                        }
                        display = String(result);
                        currentValue = null;
                        operator = null;
                        waitingForOperand = true;
                    }

                    displayEl.textContent = display;
                };

                buttonsContainer.appendChild(button);
            });

            container.appendChild(displayEl);
            container.appendChild(buttonsContainer);
            return container;
        }

        // ==================== APP: TERMINAL ====================
        function createTerminal() {
            const container = document.createElement('div');
            container.className = 'terminal';

            let currentDir = '/';
            const history = [];

            function addLine(text, isCommand = false) {
                const line = document.createElement('div');
                line.className = 'terminal-line';
                line.textContent = text;
                container.insertBefore(line, container.lastElementChild);
            }

            function processCommand(cmd) {
                const parts = cmd.trim().split(' ');
                const command = parts[0].toLowerCase();
                const args = parts.slice(1);

                history.push(cmd);

                switch(command) {
                    case '':
                        break;
                    case 'help':
                        addLine('Available commands:');
                        addLine('  help     - Show this help');
                        addLine('  ls/dir   - List files');
                        addLine('  cd       - Change directory');
                        addLine('  pwd      - Print working directory');
                        addLine('  cat      - Display file contents');
                        addLine('  mkdir    - Create directory');
                        addLine('  touch    - Create file');
                        addLine('  rm       - Remove file/folder');
                        addLine('  clear    - Clear terminal');
                        addLine('  echo     - Print text');
                        addLine('  whoami   - Display current user');
                        addLine('  date     - Display current date');
                        addLine('  matrix   - Enter the matrix');
                        break;
                    case 'ls':
                    case 'dir':
                        const folder = OS.fileSystem.getFolder(currentDir);
                        if (folder) {
                            Object.entries(folder).forEach(([name, item]) => {
                                addLine(`${item.type === 'folder' ? 'd' : '-'}  ${name}`);
                            });
                        }
                        break;
                    case 'cd':
                        if (args[0] === '..') {
                            const parts = currentDir.split('/').filter(p => p);
                            parts.pop();
                            currentDir = '/' + parts.join('/');
                        } else if (args[0]) {
                            const newPath = currentDir === '/' ? args[0] : currentDir + '/' + args[0];
                            if (OS.fileSystem.getFolder(newPath)) {
                                currentDir = newPath;
                            } else {
                                addLine(`cd: ${args[0]}: No such directory`);
                            }
                        }
                        break;
                    case 'pwd':
                        addLine(currentDir || '/');
                        break;
                    case 'cat':
                        if (args[0]) {
                            const file = OS.fileSystem.getFile(currentDir + '/' + args[0]);
                            if (file && file.type === 'file') {
                                addLine(file.content || '(empty file)');
                            } else {
                                addLine(`cat: ${args[0]}: No such file`);
                            }
                        }
                        break;
                    case 'mkdir':
                        if (args[0]) {
                            OS.fileSystem.createFolder(currentDir, args[0]);
                            addLine(`Created directory: ${args[0]}`);
                        }
                        break;
                    case 'touch':
                        if (args[0]) {
                            OS.fileSystem.createFile(currentDir, args[0], '');
                            addLine(`Created file: ${args[0]}`);
                        }
                        break;
                    case 'rm':
                        if (args[0]) {
                            OS.fileSystem.deleteItem(currentDir, args[0]);
                            addLine(`Removed: ${args[0]}`);
                        }
                        break;
                    case 'clear':
                        container.querySelectorAll('.terminal-line').forEach(l => l.remove());
                        break;
                    case 'echo':
                        addLine(args.join(' '));
                        break;
                    case 'whoami':
                        addLine(localStorage.getItem('webos-username') || 'User');
                        break;
                    case 'date':
                        addLine(new Date().toString());
                        break;
                    case 'matrix':
                        addLine('Wake up, Neo...');
                        addLine('The Matrix has you...');
                        addLine('Follow the white rabbit.');
                        break;
                    default:
                        addLine(`${command}: command not found`);
                }
            }

            addLine('Web OS Terminal v1.0');
            addLine('Type "help" for available commands.');
            addLine('');

            const inputLine = document.createElement('div');
            inputLine.className = 'terminal-input-line';

            const prompt = document.createElement('span');
            prompt.className = 'terminal-prompt';
            prompt.textContent = '‚ûú ';

            const input = document.createElement('input');
            input.className = 'terminal-input';
            input.type = 'text';
            input.autofocus = true;

            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    addLine(`‚ûú ${input.value}`);
                    processCommand(input.value);
                    input.value = '';
                }
            };

            inputLine.appendChild(prompt);
            inputLine.appendChild(input);
            container.appendChild(inputLine);

            container.onclick = () => input.focus();

            return container;
        }

        // ==================== APP: BROWSER ====================
        function createBrowser() {
            const container = document.createElement('div');
            container.className = 'browser-container';

            const toolbar = document.createElement('div');
            toolbar.className = 'browser-toolbar';

            const backBtn = document.createElement('button');
            backBtn.className = 'browser-nav-btn';
            backBtn.textContent = '‚Üê';

            const forwardBtn = document.createElement('button');
            forwardBtn.className = 'browser-nav-btn';
            forwardBtn.textContent = '‚Üí';

            const refreshBtn = document.createElement('button');
            refreshBtn.className = 'browser-nav-btn';
            refreshBtn.textContent = '‚Üª';

            const addressBar = document.createElement('input');
            addressBar.className = 'browser-address';
            addressBar.value = 'https://www.example.com';

            const goBtn = document.createElement('button');
            goBtn.className = 'browser-go';
            goBtn.textContent = 'Go';

            toolbar.appendChild(backBtn);
            toolbar.appendChild(forwardBtn);
            toolbar.appendChild(refreshBtn);
            toolbar.appendChild(addressBar);
            toolbar.appendChild(goBtn);

            const content = document.createElement('div');
            content.className = 'browser-content';
            content.innerHTML = `
                <h1>Welcome to the Web Browser</h1>
                <p>This is a simulated browser within Web OS.</p>
                <p>Enter a URL and click Go to "navigate" (simulation only).</p>
                <hr>
                <h2>Quick Links</h2>
                <ul>
                    <li>üè† Home</li>
                    <li>üì∞ News</li>
                    <li>üéÆ Games</li>
                    <li>üìß Email</li>
                </ul>
            `;

            goBtn.onclick = () => {
                content.innerHTML = `
                    <h1>${addressBar.value}</h1>
                    <p>Simulated page for: ${addressBar.value}</p>
                    <p>In a real implementation, this would load actual web content.</p>
                `;
            };

            addressBar.onkeydown = (e) => {
                if (e.key === 'Enter') goBtn.click();
            };

            container.appendChild(toolbar);
            container.appendChild(content);
            return container;
        }

        // ==================== APP: PAINT ====================
        function createPaint() {
            const container = document.createElement('div');
            container.className = 'paint-container';

            let currentTool = 'pencil';
            let currentColor = '#000000';
            let brushSize = 3;
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // Toolbar
            const toolbar = document.createElement('div');
            toolbar.className = 'paint-toolbar';

            const tools = [
                { id: 'pencil', icon: '‚úèÔ∏è' },
                { id: 'brush', icon: 'üñåÔ∏è' },
                { id: 'eraser', icon: 'üßΩ' },
                { id: 'fill', icon: 'ü™£' },
                { id: 'clear', icon: 'üóëÔ∏è' }
            ];

            tools.forEach(tool => {
                const btn = document.createElement('div');
                btn.className = 'paint-tool' + (tool.id === currentTool ? ' active' : '');
                btn.textContent = tool.icon;
                btn.title = tool.id;
                btn.onclick = () => {
                    toolbar.querySelectorAll('.paint-tool').forEach(t => t.classList.remove('active'));
                    btn.classList.add('active');
                    if (tool.id === 'clear') {
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    } else {
                        currentTool = tool.id;
                    }
                };
                toolbar.appendChild(btn);
            });

            // Colors
            const colorsContainer = document.createElement('div');
            colorsContainer.className = 'paint-colors';
            const colors = ['#000000', '#ffffff', '#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff8800', '#8800ff'];
            colors.forEach(color => {
                const colorEl = document.createElement('div');
                colorEl.className = 'paint-color' + (color === currentColor ? ' active' : '');
                colorEl.style.background = color;
                colorEl.onclick = () => {
                    colorsContainer.querySelectorAll('.paint-color').forEach(c => c.classList.remove('active'));
                    colorEl.classList.add('active');
                    currentColor = color;
                };
                colorsContainer.appendChild(colorEl);
            });
            toolbar.appendChild(colorsContainer);

            // Size slider
            const sizeSlider = document.createElement('input');
            sizeSlider.type = 'range';
            sizeSlider.min = 1;
            sizeSlider.max = 30;
            sizeSlider.value = brushSize;
            sizeSlider.style.marginLeft = '20px';
            sizeSlider.oninput = () => brushSize = sizeSlider.value;
            toolbar.appendChild(sizeSlider);

            // Canvas
            const canvasContainer = document.createElement('div');
            canvasContainer.className = 'paint-canvas-container';

            const canvas = document.createElement('canvas');
            canvas.className = 'paint-canvas';
            canvas.width = 600;
            canvas.height = 400;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            canvas.onmousedown = (e) => {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                lastX = e.clientX - rect.left;
                lastY = e.clientY - rect.top;

                if (currentTool === 'fill') {
                    ctx.fillStyle = currentColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
            };

            canvas.onmousemove = (e) => {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : currentColor;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.stroke();

                lastX = x;
                lastY = y;
            };

            canvas.onmouseup = () => isDrawing = false;
            canvas.onmouseleave = () => isDrawing = false;

            canvasContainer.appendChild(canvas);
            container.appendChild(toolbar);
            container.appendChild(canvasContainer);
            return container;
        }

        // ==================== APP: MUSIC PLAYER ====================
        function createMusicPlayer() {
            const container = document.createElement('div');
            container.className = 'music-player';

            let isPlaying = false;

            container.innerHTML = `
                <div class="music-artwork">üéµ</div>
                <div class="music-info">
                    <div class="music-title">No Track Playing</div>
                    <div class="music-artist">Unknown Artist</div>
                </div>
                <div class="music-progress">
                    <div class="music-progress-fill"></div>
                </div>
                <div class="music-time">
                    <span>0:00</span>
                    <span>3:45</span>
                </div>
                <div class="music-controls">
                    <button class="music-btn">‚èÆ</button>
                    <button class="music-btn play">‚ñ∂</button>
                    <button class="music-btn">‚è≠</button>
                </div>
                <div class="music-volume">
                    <span>üîä</span>
                    <input type="range" min="0" max="100" value="70">
                </div>
            `;

            const playBtn = container.querySelector('.play');
            playBtn.onclick = () => {
                isPlaying = !isPlaying;
                playBtn.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
                container.querySelector('.music-title').textContent = isPlaying ? 'Sample Track' : 'No Track Playing';
            };

            return container;
        }

        // ==================== APP: MINESWEEPER ====================
        function createMinesweeper() {
            const container = document.createElement('div');
            container.className = 'minesweeper';

            const ROWS = 9;
            const COLS = 9;
            const MINES = 10;
            let grid = [];
            let revealed = [];
            let flagged = [];
            let gameOver = false;
            let minesLeft = MINES;
            let timer = 0;
            let timerInterval = null;

            const header = document.createElement('div');
            header.className = 'mine-header';
            header.innerHTML = `
                <div class="mine-counter">${MINES}</div>
                <div class="mine-reset">üòä</div>
                <div class="mine-timer">000</div>
            `;

            const gridEl = document.createElement('div');
            gridEl.className = 'mine-grid';
            gridEl.style.gridTemplateColumns = `repeat(${COLS}, 25px)`;

            function initGame() {
                grid = [];
                revealed = [];
                flagged = [];
                gameOver = false;
                minesLeft = MINES;
                timer = 0;
                if (timerInterval) clearInterval(timerInterval);

                header.querySelector('.mine-counter').textContent = MINES;
                header.querySelector('.mine-timer').textContent = '000';
                header.querySelector('.mine-reset').textContent = 'üòä';

                // Initialize grid
                for (let r = 0; r < ROWS; r++) {
                    grid[r] = [];
                    revealed[r] = [];
                    flagged[r] = [];
                    for (let c = 0; c < COLS; c++) {
                        grid[r][c] = 0;
                        revealed[r][c] = false;
                        flagged[r][c] = false;
                    }
                }

                // Place mines
                let placed = 0;
                while (placed < MINES) {
                    const r = Math.floor(Math.random() * ROWS);
                    const c = Math.floor(Math.random() * COLS);
                    if (grid[r][c] !== -1) {
                        grid[r][c] = -1;
                        placed++;
                    }
                }

                // Calculate numbers
                for (let r = 0; r < ROWS; r++) {
                    for (let c = 0; c < COLS; c++) {
                        if (grid[r][c] === -1) continue;
                        let count = 0;
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                const nr = r + dr, nc = c + dc;
                                if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS && grid[nr][nc] === -1) {
                                    count++;
                                }
                            }
                        }
                        grid[r][c] = count;
                    }
                }

                renderGrid();
            }

            function renderGrid() {
                gridEl.innerHTML = '';
                for (let r = 0; r < ROWS; r++) {
                    for (let c = 0; c < COLS; c++) {
                        const cell = document.createElement('div');
                        cell.className = 'mine-cell';

                        if (revealed[r][c]) {
                            cell.classList.add('revealed');
                            if (grid[r][c] === -1) {
                                cell.textContent = 'üí£';
                                cell.classList.add('mine');
                            } else if (grid[r][c] > 0) {
                                cell.textContent = grid[r][c];
                                cell.setAttribute('data-count', grid[r][c]);
                            }
                        } else if (flagged[r][c]) {
                            cell.classList.add('flagged');
                        }

                        cell.onclick = () => revealCell(r, c);
                        cell.oncontextmenu = (e) => {
                            e.preventDefault();
                            toggleFlag(r, c);
                        };

                        gridEl.appendChild(cell);
                    }
                }
            }

            function revealCell(r, c) {
                if (gameOver || revealed[r][c] || flagged[r][c]) return;

                if (timer === 0) {
                    timerInterval = setInterval(() => {
                        timer++;
                        header.querySelector('.mine-timer').textContent = timer.toString().padStart(3, '0');
                    }, 1000);
                }

                revealed[r][c] = true;

                if (grid[r][c] === -1) {
                    // Game over
                    gameOver = true;
                    clearInterval(timerInterval);
                    header.querySelector('.mine-reset').textContent = 'üòµ';
                    // Reveal all mines
                    for (let row = 0; row < ROWS; row++) {
                        for (let col = 0; col < COLS; col++) {
                            if (grid[row][col] === -1) revealed[row][col] = true;
                        }
                    }
                    playSound('error');
                } else if (grid[r][c] === 0) {
                    // Flood fill
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            const nr = r + dr, nc = c + dc;
                            if (nr >= 0 && nr < ROWS && nc >= 0 && nc < COLS) {
                                revealCell(nr, nc);
                            }
                        }
                    }
                }

                // Check win
                let unrevealed = 0;
                for (let row = 0; row < ROWS; row++) {
                    for (let col = 0; col < COLS; col++) {
                        if (!revealed[row][col]) unrevealed++;
                    }
                }
                if (unrevealed === MINES && !gameOver) {
                    gameOver = true;
                    clearInterval(timerInterval);
                    header.querySelector('.mine-reset').textContent = 'üòé';
                    showNotification('Minesweeper', 'You win! üéâ');
                }

                renderGrid();
            }

            function toggleFlag(r, c) {
                if (gameOver || revealed[r][c]) return;
                flagged[r][c] = !flagged[r][c];
                minesLeft += flagged[r][c] ? -1 : 1;
                header.querySelector('.mine-counter').textContent = minesLeft;
                renderGrid();
            }

            header.querySelector('.mine-reset').onclick = initGame;

            container.appendChild(header);
            container.appendChild(gridEl);
            initGame();

            return container;
        }

        // ==================== APP: SOLITAIRE ====================
        function createSolitaire() {
            const container = document.createElement('div');
            container.className = 'solitaire';

            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

            let deck = [];
            let waste = [];
            let foundations = [[], [], [], []];
            let tableau = [[], [], [], [], [], [], []];

            function createDeck() {
                deck = [];
                suits.forEach(suit => {
                    values.forEach((value, index) => {
                        deck.push({
                            suit,
                            value,
                            rank: index,
                            faceUp: false,
                            color: (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black'
                        });
                    });
                });
                // Shuffle
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }

            function dealCards() {
                waste = [];
                foundations = [[], [], [], []];
                tableau = [[], [], [], [], [], [], []];

                for (let i = 0; i < 7; i++) {
                    for (let j = i; j < 7; j++) {
                        const card = deck.pop();
                        card.faceUp = (j === i);
                        tableau[j].push(card);
                    }
                }
            }

            function renderCard(card, faceUp = true) {
                if (!card) return '';
                if (!faceUp || !card.faceUp) {
                    return '<div class="card face-down"></div>';
                }
                return `<div class="card ${card.color}">
                    <div>${card.value}${card.suit}</div>
                    <div style="align-self: flex-end; transform: rotate(180deg)">${card.value}${card.suit}</div>
                </div>`;
            }

            function render() {
                container.innerHTML = `
                    <div class="solitaire-top">
                        <div class="solitaire-deck">
                            <div class="card-slot" id="deck-pile">${deck.length > 0 ? '<div class="card face-down"></div>' : 'üîÑ'}</div>
                            <div class="card-slot" id="waste-pile">${waste.length > 0 ? renderCard(waste[waste.length - 1]) : ''}</div>
                        </div>
                        <div class="solitaire-foundations">
                            ${foundations.map((f, i) => `
                                <div class="card-slot foundation" data-index="${i}">
                                    ${f.length > 0 ? renderCard(f[f.length - 1]) : suits[i]}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="solitaire-tableau">
                        ${tableau.map((pile, i) => `
                            <div class="tableau-pile" data-pile="${i}">
                                ${pile.map((card, j) => `
                                    <div class="card ${card.faceUp ? card.color : 'face-down'}"
                                         style="top: ${j * 25}px"
                                         data-pile="${i}" data-index="${j}">
                                        ${card.faceUp ? `<div>${card.value}${card.suit}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;

                // Deck click
                container.querySelector('#deck-pile').onclick = () => {
                    if (deck.length > 0) {
                        const card = deck.pop();
                        card.faceUp = true;
                        waste.push(card);
                    } else {
                        deck = waste.reverse();
                        deck.forEach(c => c.faceUp = false);
                        waste = [];
                    }
                    render();
                };
            }

            createDeck();
            dealCards();
            render();

            return container;
        }

        // ==================== APP: SETTINGS ====================
        function createSettings() {
            const container = document.createElement('div');
            container.className = 'settings-container';

            const sidebar = document.createElement('div');
            sidebar.className = 'settings-sidebar';

            const sections = [
                { id: 'personalization', label: 'üé® Personalization' },
                { id: 'system', label: 'üíª System' },
                { id: 'sound', label: 'üîä Sound' },
                { id: 'about', label: '‚ÑπÔ∏è About' }
            ];

            const content = document.createElement('div');
            content.className = 'settings-content';

            function showSection(sectionId) {
                sidebar.querySelectorAll('.settings-sidebar-item').forEach(i => i.classList.remove('active'));
                sidebar.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

                switch(sectionId) {
                    case 'personalization':
                        content.innerHTML = `
                            <div class="settings-section">
                                <h3>Theme</h3>
                                <div class="theme-preview">
                                    <div class="theme-card ${OS.theme === 'default' ? 'active' : ''}" data-theme="default">
                                        <div class="theme-card-preview" style="background: #008080;"></div>
                                        <div class="theme-card-label">Windows 95</div>
                                    </div>
                                    <div class="theme-card ${OS.theme === 'xp' ? 'active' : ''}" data-theme="xp">
                                        <div class="theme-card-preview" style="background: linear-gradient(#3168d5, #1941a5);"></div>
                                        <div class="theme-card-label">Windows XP</div>
                                    </div>
                                    <div class="theme-card ${OS.theme === 'dark' ? 'active' : ''}" data-theme="dark">
                                        <div class="theme-card-preview" style="background: #1a1a2e;"></div>
                                        <div class="theme-card-label">Dark Mode</div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-section" style="margin-top: 20px;">
                                <h3>Wallpaper</h3>
                                <div class="settings-option">
                                    <label>Wallpaper URL:</label>
                                    <input type="text" id="wallpaper-input" placeholder="Enter image URL..." value="${OS.wallpaper}" style="width: 100%;">
                                </div>
                                <button id="apply-wallpaper" style="padding: 8px 20px; margin-top: 10px;">Apply</button>
                            </div>
                        `;
                        content.querySelectorAll('.theme-card').forEach(card => {
                            card.onclick = () => {
                                applyTheme(card.dataset.theme);
                                showSection('personalization');
                            };
                        });
                        content.querySelector('#apply-wallpaper').onclick = () => {
                            const url = content.querySelector('#wallpaper-input').value;
                            OS.wallpaper = url;
                            localStorage.setItem('webos-wallpaper', url);
                            document.getElementById('desktop').style.backgroundImage = url ? `url(${url})` : '';
                            showNotification('Settings', 'Wallpaper applied!');
                        };
                        break;
                    case 'system':
                        content.innerHTML = `
                            <div class="settings-section">
                                <h3>System Information</h3>
                                <p><strong>OS:</strong> Web OS 1.0</p>
                                <p><strong>Processor:</strong> Virtual CPU @ 3.0 GHz</p>
                                <p><strong>Memory:</strong> 16 GB</p>
                                <p><strong>Storage:</strong> 1 TB Virtual</p>
                            </div>
                            <div class="settings-section" style="margin-top: 20px;">
                                <h3>User</h3>
                                <div class="settings-option">
                                    <label>Username:</label>
                                    <input type="text" id="username-input" value="${localStorage.getItem('webos-username') || 'User'}">
                                </div>
                                <button id="save-username" style="padding: 8px 20px; margin-top: 10px;">Save</button>
                            </div>
                            <div class="settings-section" style="margin-top: 20px;">
                                <h3>Reset</h3>
                                <button id="reset-os" style="padding: 8px 20px; background: #e74c3c; color: white; border: none;">Reset All Settings</button>
                            </div>
                        `;
                        content.querySelector('#save-username').onclick = () => {
                            localStorage.setItem('webos-username', content.querySelector('#username-input').value);
                            showNotification('Settings', 'Username saved!');
                        };
                        content.querySelector('#reset-os').onclick = () => {
                            if (confirm('Reset all settings and files? This cannot be undone.')) {
                                localStorage.clear();
                                location.reload();
                            }
                        };
                        break;
                    case 'sound':
                        content.innerHTML = `
                            <div class="settings-section">
                                <h3>Sound Settings</h3>
                                <div class="settings-option">
                                    <label>
                                        <input type="checkbox" id="sound-enabled" ${OS.soundEnabled ? 'checked' : ''}>
                                        Enable system sounds
                                    </label>
                                </div>
                                <button id="test-sound" style="padding: 8px 20px; margin-top: 10px;">Test Sound</button>
                            </div>
                        `;
                        content.querySelector('#sound-enabled').onchange = (e) => {
                            OS.soundEnabled = e.target.checked;
                            localStorage.setItem('webos-sound', OS.soundEnabled);
                            updateSoundIcon();
                        };
                        content.querySelector('#test-sound').onclick = () => {
                            playSound('notification');
                        };
                        break;
                    case 'about':
                        content.innerHTML = `
                            <div class="settings-section" style="text-align: center; padding-top: 40px;">
                                <h1 style="font-size: 48px; margin-bottom: 20px;">ü™ü</h1>
                                <h2>Web OS</h2>
                                <p style="color: #666;">Version 1.0</p>
                                <p style="margin-top: 30px;">A fully-featured operating system simulation<br>running entirely in your browser.</p>
                                <p style="margin-top: 30px; color: #888;">¬© 2025 Web OS</p>
                            </div>
                        `;
                        break;
                }
            }

            sections.forEach(section => {
                const item = document.createElement('div');
                item.className = 'settings-sidebar-item';
                item.setAttribute('data-section', section.id);
                item.textContent = section.label;
                item.onclick = () => showSection(section.id);
                sidebar.appendChild(item);
            });

            container.appendChild(sidebar);
            container.appendChild(content);

            showSection('personalization');

            return container;
        }

        // ==================== APP: TASK MANAGER ====================
        function createTaskManager() {
            const container = document.createElement('div');
            container.className = 'task-manager';

            function render() {
                container.innerHTML = `
                    <div class="task-list">
                        ${OS.windows.map(w => `
                            <div class="task-item">
                                <span>${w.title}</span>
                                <button onclick="closeWindow('${w.id}')" style="padding: 2px 10px;">End Task</button>
                            </div>
                        `).join('')}
                        ${OS.windows.length === 0 ? '<div class="task-item">No running applications</div>' : ''}
                    </div>
                    <div class="task-stats">
                        <div class="stat-item">
                            <div class="stat-value">${OS.windows.length}</div>
                            <div class="stat-label">Running Apps</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.floor(Math.random() * 30 + 10)}%</div>
                            <div class="stat-label">CPU Usage</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.floor(Math.random() * 40 + 30)}%</div>
                            <div class="stat-label">Memory</div>
                        </div>
                    </div>
                `;
            }

            render();
            const interval = setInterval(render, 2000);

            // Clean up when window closes
            container.cleanup = () => clearInterval(interval);

            return container;
        }

        // ==================== APP: IMAGE VIEWER ====================
        function createImageViewer() {
            const container = document.createElement('div');
            container.className = 'image-viewer';

            container.innerHTML = `
                <div class="image-viewer-toolbar">
                    <button class="image-viewer-btn">üìÇ Open</button>
                    <button class="image-viewer-btn">üîç+ Zoom In</button>
                    <button class="image-viewer-btn">üîç- Zoom Out</button>
                    <button class="image-viewer-btn">‚Üª Rotate</button>
                </div>
                <div class="image-viewer-content">
                    <p style="color: #888;">No image loaded.<br>Click Open to select an image.</p>
                </div>
            `;

            return container;
        }

        // ==================== START ====================
        document.addEventListener('DOMContentLoaded', bootSequence);
    </script>
</body>
</html>
